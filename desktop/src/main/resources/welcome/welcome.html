<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <link href="/favicon.svg" rel="icon"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Cognotik</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .logo {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        a {
            color: #3498db;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input[type="text"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            height: 150px;
            font-family: monospace;
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .wizard-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .wizard-step {
            display: flex;
            align-items: center;
            margin-right: 15px;
            transition: all 0.3s ease;
        }

        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            color: #555;
            margin-right: 10px;
            font-weight: bold;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .active .step-number {
            background-color: #3498db;
            color: white;
        }

        .active .step-text {
            font-weight: bold;
            color: #3498db;
        }

        .wizard-content {
            display: none;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .wizard-content.active {
            display: block;
        }

        .api-settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            z-index: 100;
        }

        .api-settings-btn:hover {
            background-color: #2980b9;
        }

        .menu-bar {
            position: fixed;
            top: 0;
            right: 0;
            display: flex;
            align-items: center;
            z-index: 100;
            gap: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .menu-button {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .menu-button:hover {
            background-color: #2980b9;
        }

        /* Add padding to the top to prevent content from being hidden under the menu bar */
        body {
            padding-top: 50px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .wizard-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

            font-size: 16px;
        }

        .button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        .button.secondary {
            background-color: #95a5a6;
        }

        .button.secondary:hover {
            background-color: #7f8c8d;
        }

        .api-key-group {
            display: flex;
            margin-bottom: 10px;
        }

        .api-key-group label {
            width: 120px;
            padding-top: 8px;
        }

        .api-key-group input {
            flex-grow: 1;
        }

        .task-toggle {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .task-toggle:hover {
            background-color: #f5f5f5;
            transform: translateX(2px);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive improvements */
        @media (max-width: 600px) {
            .wizard-nav {
                flex-direction: column;
            }

            .wizard-step {
                margin-bottom: 5px;
                border-radius: 4px;
            }

            .api-key-group {
                flex-direction: column;
            }

            .api-key-group label {
                width: 100%;
                margin-bottom: 5px;
            }

            .button-group {
                flex-direction: column;
            }

            .wizard-buttons {
                flex-direction: column;
            }

            .button {
                margin-bottom: 10px;
            }

            .logo-container {
                margin-right: 5px;
            }

            .logo {
                width: 30px;
                height: 30px;
            }

            .menu-bar {
                padding: 5px;
            }

            .button {
                margin-bottom: 10px;
            }
        }

        /* Accessibility improvements */
        .button:focus, input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.5);
        }

        /* Footer styling */
        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .footer-logo {
            vertical-align: middle;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
                color: #f0f0f0;
            }

            .card, .modal-content, .wizard-content, .wizard-nav {
                background-color: #2a2a2a;
                color: #f0f0f0;
            }

            .menu-bar {
                background-color: rgba(42, 42, 42, 0.9);
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            }

            .close {
                color: #ddd;
            }

            .close:hover {
                color: white;
            }

            h1 {
                color: #3498db;
            }

            .task-toggle, .form-group input, .form-group select {
                background-color: #333;
                color: #f0f0f0;
                border-color: #555;
            }

            .task-toggle:hover {
                background-color: #444;
            }

            .button.secondary {
                background-color: #555;
            }

            .button.secondary:hover {
                background-color: #666;
            }

            .step-number {
                background-color: #444;
                color: #ddd;
            }

            .active .step-number {
                background-color: #3498db;
                color: white;
            }

            .modal {
                background-color: rgba(0, 0, 0, 0.7);
            }
        }
    </style>
</head>
<body>

<div class="menu-bar">
    <div class="logo-container">
        <img alt="Cognotik Logo" class="logo" src="logo.svg">
        <span style="font: bold">Cognotik</span>
    </div>
    <div style="width: inherit;"></div>
    <button class="menu-button" id="open-basic-chat">Basic Chat</button>
    <button class="menu-button" id="api-settings-btn">Configure API Keys</button>
</div>

<div class="modal" id="api-settings-modal">
    <div class="modal-content">
        <span class="close" id="close-api-modal">&times;</span>
        <h3>API Configuration</h3>
        <p>Configure your API keys for different AI providers:</p>
        <div id="api-keys-container">
            <!-- API keys will be populated here -->
        </div>
        <div class="button-group">
            <button class="button secondary" id="reset-api-settings">Reset</button>
            <button class="button" id="save-api-settings">Save API Settings</button>
        </div>
    </div>
</div>

<div class="wizard-nav">
    <div class="wizard-step active" data-step="cognitive-mode">
        <div class="step-number">1</div>
        <div class="step-text">Choose Mode</div>
    </div>
    <div class="wizard-step" data-step="task-selection">
        <div class="step-number">2</div>
        <div class="step-text">Select Tasks</div>
    </div>
    <div class="wizard-step" data-step="task-settings">
        <div class="step-number">3</div>
        <div class="step-text">Configure Settings</div>
    </div>
    <div class="wizard-step" data-step="launch">
        <div class="step-number">4</div>
        <div class="step-text">Launch</div>
    </div>
</div>

<div class="wizard-content active" id="cognitive-mode">
    <h3>Step 1: Choose Cognitive Mode</h3>
    <p>Select how you want the AI to approach your tasks:</p>
    <div class="form-group">
        <div class="task-toggle">
            <div>
                <input checked id="single-task-mode" name="cognitive-mode" type="radio" value="single-task">
                <label for="single-task-mode">Chat</label>
                <span class="tooltip">?
          <span class="tooltiptext">Execute individual tasks with AI assistance. Best for focused, specific tasks.</span>
        </span>
            </div>
        </div>
        <div class="task-toggle">
            <div>
                <input id="auto-plan-mode" name="cognitive-mode" type="radio" value="auto-plan">
                <label for="auto-plan-mode">Autonomous</label>
                <span class="tooltip">?
          <span class="tooltiptext">Let AI automatically plan and execute complex development tasks with minimal guidance.</span>
        </span>
            </div>
        </div>
        <div class="task-toggle">
            <div>
                <input id="plan-ahead-mode" name="cognitive-mode" type="radio" value="plan-ahead">
                <label for="plan-ahead-mode">Plan Ahead</label>
                <span class="tooltip">?
          <span class="tooltiptext">Work with AI to create detailed plans before execution, with more control over the process.</span>
        </span>
            </div>
        </div>
        <div id="auto-plan-settings"
             style="display: none; margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <div class="form-group">
                <label for="max-task-history">Max Task History Chars:</label>
                <input id="max-task-history" max="100000" min="1000" type="number" value="20000">
            </div>
            <div class="form-group">
                <label for="max-tasks-per-iteration">Max Tasks Per Iteration:</label>
                <input id="max-tasks-per-iteration" max="10" min="1" type="number" value="3">
            </div>
            <div class="form-group">
                <label for="max-iterations">Max Iterations:</label>
                <input id="max-iterations" max="1000" min="1" type="number" value="100">
            </div>
        </div>
    </div>
    <div class="wizard-buttons">
        <div></div> <!-- Empty div for spacing -->
        <button class="button" id="next-to-task-selection">Next: Select Tasks</button>
    </div>
</div>
<div class="wizard-content" id="task-selection">
    <h3>Step 2: Select Tasks</h3>
    <p>Choose which tasks you want to enable:</p>
    <div class="form-group" id="task-toggles">
        <!-- Task toggles will be populated here -->
    </div>
    <div class="wizard-buttons">
        <button class="button secondary" id="back-to-cognitive-mode">Back</button>
        <button class="button" id="next-to-task-settings">Next: Configure Settings</button>
    </div>
</div>
<div class="wizard-content" id="task-settings">
    <h3>Step 3: Configure Settings</h3>
    <p>Configure model and environment settings:</p>

    <div class="form-group">
        <label for="model-selection">Default Model:</label>
        <select id="model-selection">
            <option value="GPT4o">GPT-4o</option>
            <option value="GPT4">GPT-4</option>
            <option value="GPT35Turbo">GPT-3.5 Turbo</option>
        </select>
    </div>

    <div class="form-group">
        <label for="parsing-model">Parsing Model:</label>
        <select id="parsing-model">
            <option value="GPT4oMini">GPT-4o Mini</option>
            <option value="GPT35Turbo">GPT-3.5 Turbo</option>
        </select>
    </div>

    <div class="form-group">
        <label for="working-dir">Working Directory:</label>
        <input id="working-dir" type="text" value=".">
    </div>
    <div class="form-group">
        <label for="temperature">Temperature: <span class="tooltip">?<span class="tooltiptext">Controls randomness in AI responses. Lower values (0.0-0.3) are more deterministic, higher values (0.7-1.0) are more creative.</span></span></label>
        <input id="temperature" max="1" min="0" step="0.1" type="range" value="0.2">
        <span id="temperature-value">0.2</span>
    </div>
    <div class="form-group">
        <div class="task-toggle">
            <div>
                <input id="auto-fix" name="auto-fix" type="checkbox">
                <label for="auto-fix">Enable Auto Fix</label>
                <span class="tooltip">?<span
                        class="tooltiptext">Automatically attempt to fix errors in code execution.</span></span>
            </div>

            <div id="graph-settings"
                 style="display: none; margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <div class="form-group">
                    <label for="graph-file">Graph File Path:</label>
                    <input id="graph-file" placeholder="Enter path to graph file" type="text">
                </div>
            </div>
        </div>
    </div>

    <div class="wizard-buttons">
        <button class="button secondary" id="back-to-task-selection">Back</button>
        <button class="button" id="next-to-launch">Next: Review & Launch</button>
    </div>
</div>

<div class="wizard-content" id="launch">
    <h3>Step 4: Review & Launch</h3>
    <p>Review your configuration and launch your AI development session:</p>

    <div class="wizard-buttons">
        <button class="button secondary" id="back-to-task-settings">Back</button>
        <button class="button" id="launch-session">Launch AI Session</button>
    </div>

    <div class="form-group">
        <h4>Cognitive Mode</h4>
        <div id="cognitive-mode-summary"></div>
    </div>

    <div class="form-group">
        <h4>Task Settings</h4>
        <div id="task-settings-summary"></div>
    </div>

    <div class="form-group">
        <h4>API Settings</h4>
        <div id="api-settings-summary"></div>
    </div>

</div>

<div class="loading" id="loading">
    <div class="spinner"></div>
    <p>Setting up your session...</p>
</div>

<footer style="margin-top: 40px; text-align: center; font-size: 0.8em; color: #7f8c8d;">
    <div class="footer-content">
        <img alt="Cognotik Logo" class="footer-logo" height="24" src="logo.svg" width="24">
        <p>Cognotik &copy; 2025 SimiaCryptus Software</p>
    </div>
</footer>
<script>

    function generateSessionId() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');

        const randomChars = Math.random().toString(36).substring(2, 6);
        return `U-${year}${month}${day}-${randomChars}`;
    }

    let sessionId = generateSessionId();
    let apiSettings = {};
    let taskSettings = {
        defaultModel: localStorage.getItem('defaultModel') || 'GPT4o',
        parsingModel: localStorage.getItem('parsingModel') || 'GPT4oMini',
        workingDir: localStorage.getItem('workingDir') || '.',
        autoFix: localStorage.getItem('autoFix') === 'true',
        maxTaskHistoryChars: 20000,
        maxTasksPerIteration: 3,
        maxIterations: 100,
        graphFile: '',
        taskSettings: {},
    };
    let cognitiveMode = localStorage.getItem('cognitiveMode') || 'single-task';

    const taskTypes = [
        {
            id: 'InsightTask',
            name: 'Insight Task',
            description: 'Analyze code and provide detailed explanations of implementation patterns',
            tooltip: 'Provides detailed answers and insights about code implementation by analyzing specified files.',
        },
        {
            id: 'FileModificationTask',
            name: 'File Modification Task',
            description: 'Create new files or modify existing code with AI-powered assistance',
            tooltip: 'Creates or modifies source files with AI assistance while maintaining code quality.',
        },
        {
            id: 'RunShellCommandTask',
            name: 'Run Shell Command Task',
            description: 'Execute shell commands safely',
            tooltip: 'Executes shell commands in a controlled environment.',
        },
        {
          id: 'CommandAutoFixTask',
          name: 'Command Auto Fix Task',
          description: 'Run a command and automatically fix any issues that arise',
          tooltip: 'Executes a command and automatically fixes any issues that arise.',
        },
        {
            id: 'FileSearchTask',
            name: 'File Search Task',
            description: 'Search project files using patterns with contextual results',
            tooltip: 'Performs pattern-based searches across project files with context.',
        },
        /*
            {
              id: 'TaskPlanningTask',
              name: 'Task Planning Task',
              description: 'Break down and coordinate complex development tasks with dependency management',
              tooltip: 'Orchestrates complex development tasks by breaking them down into manageable subtasks.',
            },
        */
        /*{
          id: 'ForeachTask',
          name: 'Foreach Task',
          description: 'Execute subtasks for each item in a list',
          tooltip: 'Executes a set of subtasks for each item in a given list.',
        },*/
        {
            id: 'CrawlerAgentTask',
            name: 'Web Search Task',
            description: 'Search Google, fetch top results, and analyze content',
            tooltip: 'Searches Google for specified queries and analyzes the top results.',
        },
        {
            id: 'GitHubSearchTask',
            name: 'GitHub Search Task',
            description: 'Search GitHub repositories, code, issues and users',
            tooltip: 'Performs comprehensive searches across GitHub\'s content.',
        },
        /*
            {
              id: 'KnowledgeIndexingTask',
              name: 'Knowledge Indexing Task',
              description: 'Index content for semantic search capabilities',
              tooltip: 'Indexes documents and code for semantic search capabilities.',
            },
            {
              id: 'EmbeddingSearchTask',
              name: 'Embedding Search Task',
              description: 'Perform semantic search using AI embeddings',
              tooltip: 'Performs semantic search using AI embeddings across indexed content.',
            },
            {
              id: 'SeleniumSessionTask',
              name: 'Selenium Session Task',
              description: 'Automate browser interactions with Selenium',
              tooltip: 'Automates browser interactions using Selenium WebDriver.',
            },
            {
              id: 'CommandSessionTask',
              name: 'Command Session Task',
              description: 'Manage interactive command-line sessions',
              tooltip: 'Manages interactive command-line sessions with state persistence.',
            },
            {
              id: 'SoftwareGraphPlanningTask',
              name: 'Software Graph Planning Task',
              description: 'Generate and execute task plans based on software graph structure',
              tooltip: 'Creates task plans using software graph context.',
            },
            {
              id: 'SoftwareGraphModificationTask',
              name: 'Software Graph Modification Task',
              description: 'Modify an existing software graph representation',
              tooltip: 'Loads, modifies and saves software graph representations.',
            },
            {
              id: 'SoftwareGraphGenerationTask',
              name: 'Software Graph Generation Task',
              description: 'Generate a SoftwareGraph representation of the codebase',
              tooltip: 'Generates a comprehensive SoftwareGraph representation of the codebase.',
            },
            {
              id: 'DataTableCompilationTask',
              name: 'Data Table Compilation Task',
              description: 'Compile structured data tables from multiple files',
              tooltip: 'Extracts and compiles structured data from multiple files into a unified table.',
            },
        */
    ];

    const apiProviders = [
        {id: 'OpenAI', name: 'OpenAI', baseUrl: 'https://api.openai.com/v1'},
        {id: 'Anthropic', name: 'Anthropic', baseUrl: 'https://api.anthropic.com/v1'},
        {id: 'Google', name: 'Google', baseUrl: 'https://generativelanguage.googleapis.com'},
        {id: 'Groq', name: 'Groq', baseUrl: 'https://api.groq.com/openai/v1'},
        {id: 'Mistral', name: 'Mistral', baseUrl: 'https://api.mistral.ai/v1'},
        {id: 'AWS', name: 'AWS', baseUrl: 'https://api.openai.aws'},


        {id: 'DeepSeek', name: 'DeepSeek', baseUrl: 'https://api.deepseek.com'},
        {id: 'Github', name: 'GitHub', baseUrl: 'https://api.github.com'},
        {id: 'GoogleSearch', name: 'Google Search', baseUrl: ''},
    ];

    const availableModels = {
        OpenAI: [
            {id: 'GPT4o', name: 'GPT-4o', description: 'OpenAI\'s capable vision model'},
            {id: 'GPT4oMini', name: 'GPT-4o Mini', description: 'Smaller, faster version of GPT-4o'},
            {id: 'O1', name: 'o1', description: 'OpenAI\'s reasoning-focused model'},
            {id: 'O1Mini', name: 'o1-mini', description: 'Smaller version of o1'},
            {id: 'O1Preview', name: 'o1-preview', description: 'Preview version of o1'},
            {id: 'O3', name: 'o3', description: 'OpenAI\'s advanced reasoning model'},
            {id: 'O3Mini', name: 'o3-mini', description: 'Smaller version of o3'},
            {id: 'O4Mini', name: 'o4-mini', description: 'Latest mini reasoning model'},
            {id: 'GPT41', name: 'GPT-4.1', description: 'Latest GPT-4 series model'},
            {id: 'GPT41Mini', name: 'GPT-4.1 Mini', description: 'Smaller version of GPT-4.1'},
            {id: 'GPT41Nano', name: 'GPT-4.1 Nano', description: 'Smallest version of GPT-4.1'},
            {id: 'GPT45', name: 'GPT-4.5', description: 'Advanced preview model'},
        ],
        Anthropic: [
            {id: 'Claude35Sonnet', name: 'Claude 3.5 Sonnet', description: 'Anthropic\'s advanced model'},
            {id: 'Claude37Sonnet', name: 'Claude 3.7 Sonnet', description: 'Anthropic\'s latest model'},
            {id: 'Claude35Haiku', name: 'Claude 3.5 Haiku', description: 'Smaller, faster Claude model'},
            {id: 'Claude3Opus', name: 'Claude 3 Opus', description: 'Anthropic\'s most capable model'},
            {id: 'Claude3Sonnet', name: 'Claude 3 Sonnet', description: 'Balanced Claude model'},
            {id: 'Claude3Haiku', name: 'Claude 3 Haiku', description: 'Fast, efficient Claude model'},
        ],
        Groq: [
            {id: 'Llama33_70bVersatile', name: 'Llama 3.3 70B Versatile', description: 'Fast Llama 3.3 inference'},
            {id: 'Llama33_70bSpecDec', name: 'Llama 3.3 70B SpecDec', description: 'Specialized Llama 3.3 model'},
            {id: 'Llama31_8bInstant', name: 'Llama 3.1 8B Instant', description: 'Fast, small Llama model'},
            {id: 'Gemma2_9b', name: 'Gemma 2 9B', description: 'Google\'s Gemma model on Groq'},
            {id: 'MistralSaba24b', name: 'Mistral Saba 24B', description: 'Mistral\'s Saba model'},
            {id: 'Qwen25_32b', name: 'Qwen 2.5 32B', description: 'Qwen model on Groq'},
        ],
        Mistral: [
            {id: 'Mistral7B', name: 'Mistral 7B', description: 'Mistral\'s base model'},
            {id: 'MistralSmall', name: 'Mistral Small', description: 'Mistral\'s small model'},
            {id: 'MistralMedium', name: 'Mistral Medium', description: 'Mistral\'s medium model'},
            {id: 'MistralLarge', name: 'Mistral Large', description: 'Mistral\'s large model'},
            {id: 'Mixtral8x7B', name: 'Mixtral 8x7B', description: 'Mistral\'s Mixtral model'},
            {id: 'Mixtral8x22B', name: 'Mixtral 8x22B', description: 'Mistral\'s larger Mixtral model'},
            {id: 'Codestral', name: 'Codestral', description: 'Mistral\'s code-focused model'},
        ],
        DeepSeek: [
            {id: 'DeepSeekChat', name: 'DeepSeek Chat', description: 'DeepSeek\'s general chat model'},
            {id: 'DeepSeekCoder', name: 'DeepSeek Coder', description: 'DeepSeek\'s code-focused model'},
            {id: 'DeepSeekReasoner', name: 'DeepSeek Reasoner', description: 'DeepSeek\'s reasoning model'},
        ],
        AWS: [
            {id: 'AWSLLaMA31_405bChat', name: 'Llama 3.1 405B', description: 'Largest Llama model on AWS'},
            {id: 'AWSLLaMA31_70bChat', name: 'Llama 3.1 70B', description: 'Large Llama model on AWS'},
            {id: 'Claude35SonnetAWS', name: 'Claude 3.5 Sonnet (AWS)', description: 'Claude on AWS'},
            {id: 'Claude37SonnetAWS', name: 'Claude 3.7 Sonnet (AWS)', description: 'Latest Claude on AWS'},
            {id: 'MistralLarge2407', name: 'Mistral Large 2407', description: 'Latest Mistral Large on AWS'},
        ],
    };

    function populateModelSelections() {
        const modelSelect = document.getElementById('model-selection');
        const parsingModelSelect = document.getElementById('parsing-model');
        if (!modelSelect || !parsingModelSelect) return;

        const savedDefaultModel = taskSettings.defaultModel;
        const savedParsingModel = taskSettings.parsingModel;

        modelSelect.innerHTML = '';
        parsingModelSelect.innerHTML = '';

        const addedModels = new Set();

        if (apiSettings && apiSettings.apiKeys) {
            for (const [provider, key] of Object.entries(apiSettings.apiKeys)) {
                if (key && availableModels[provider]) {

                    availableModels[provider].forEach(model => {
                        if (!addedModels.has(model.id)) {

                            const option = document.createElement('option');
                            option.value = model.id;
                            option.textContent = `${model.name} (${provider})`;
                            option.title = model.description;
                            modelSelect.appendChild(option);

                            const parsingOption = document.createElement('option');
                            parsingOption.value = model.id;
                            parsingOption.textContent = `${model.name} (${provider})`;
                            parsingOption.title = model.description;
                            parsingModelSelect.appendChild(parsingOption);
                            addedModels.add(model.id);
                        }
                    });
                }
            }
        }

        if (modelSelect.options.length === 0) {
            const defaultOption = document.createElement('option');
            defaultOption.value = 'GPT4o';
            defaultOption.textContent = 'GPT-4o (OpenAI) - Configure API key';
            modelSelect.appendChild(defaultOption);
            const defaultParsingOption = document.createElement('option');
            defaultParsingOption.value = 'GPT4oMini';
            defaultParsingOption.textContent = 'GPT-4o Mini (OpenAI) - Configure API key';
            parsingModelSelect.appendChild(defaultParsingOption);
        }

        if (savedDefaultModel && Array.from(modelSelect.options).some(opt => opt.value === savedDefaultModel)) {
            modelSelect.value = savedDefaultModel;
        } else if (modelSelect.options.length > 0) {

            modelSelect.selectedIndex = 0;

            taskSettings.defaultModel = modelSelect.value;
        }

        if (savedParsingModel && Array.from(parsingModelSelect.options).some(opt => opt.value === savedParsingModel)) {
            parsingModelSelect.value = savedParsingModel;
        } else if (parsingModelSelect.options.length > 0) {

            parsingModelSelect.selectedIndex = 0;

            taskSettings.parsingModel = parsingModelSelect.value;
        }
    }

    function loadSettingsFromServer() {

        fetch('/userSettings/')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const textarea = doc.querySelector('textarea[name="settings"]');
                if (textarea) {
                    try {
                        const settings = JSON.parse(textarea.textContent);
                        apiSettings = settings;

                        if (apiSettings.apiKeys) {
                            for (const [provider, key] of Object.entries(apiSettings.apiKeys)) {
                                const input = document.getElementById(`api-key-${provider}`);
                                if (input && key) {
                                    input.value = '********';

                                }
                            }

                            if (settings.apiBase) {
                                for (const [provider, baseUrl] of Object.entries(settings.apiBase)) {
                                    const baseInput = document.getElementById(`api-base-${provider}`);
                                    if (baseInput && baseUrl) {
                                        baseInput.value = baseUrl;
                                    }
                                }
                            }

                        }

                        populateModelSelections();
                    } catch (e) {
                        console.error('Error parsing API settings:', e);
                    }
                }
            })
            .catch(error => {
                console.error('Error loading API settings:', error);
            });
    }

    function populateWorkingDirFromHash() {
        if (window.location.hash) {

            let workingDir = decodeURIComponent(window.location.hash.substring(1));

            const workingDirInput = document.getElementById('working-dir');
            if (workingDirInput) {
                workingDirInput.value = workingDir;

                taskSettings.workingDir = workingDir;
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {

        setupWizard();

        initializeApiSettings();

        initializeTaskToggles();

        setupEventListeners();

        loadSettingsFromServer();

        populateWorkingDirFromHash();

        populateModelSelections();

        loadSavedSettings();

        if (!taskSettings.taskSettings || Object.keys(taskSettings.taskSettings).length === 0) {
            saveTaskSelection();
        }
    });


    function setupWizard() {

        const modal = document.getElementById('api-settings-modal');
        const btn = document.getElementById('api-settings-btn');
        const closeBtn = document.getElementById('close-api-modal');

        btn.onclick = function () {
            modal.style.display = "block";
        }

        closeBtn.onclick = function () {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        document.getElementById('next-to-task-selection').addEventListener('click', () => {
            navigateToStep('task-selection');
        });

        document.getElementById('back-to-cognitive-mode').addEventListener('click', () => {
            navigateToStep('cognitive-mode');
        });

        document.getElementById('next-to-task-settings').addEventListener('click', () => {
            navigateToStep('task-settings');
        });

        document.getElementById('back-to-task-selection').addEventListener('click', () => {
            navigateToStep('task-selection');
        });

        document.getElementById('next-to-launch').addEventListener('click', () => {
            updateLaunchSummaries();
            navigateToStep('launch');
        });

        document.getElementById('back-to-task-settings').addEventListener('click', () => {
            navigateToStep('task-settings');
        });
    }

    function initializeApiSettings() {
        const container = document.getElementById('api-keys-container');

        apiProviders.forEach((provider) => {
            const keyGroup = document.createElement('div');
            keyGroup.className = 'api-key-group';
            const label = document.createElement('label');
            label.textContent = provider.name + ':';
            label.setAttribute('for', `api-key-${provider.id}`);
            const input = document.createElement('input');
            input.type = 'password';
            input.id = `api-key-${provider.id}`;

            if (provider.id === 'GoogleSearch') {
                input.placeholder = `Enter Google API key for search`;

                const searchEngineGroup = document.createElement('div');
                searchEngineGroup.className = 'api-key-group';
                const searchEngineLabel = document.createElement('label');
                searchEngineLabel.textContent = 'Search Engine ID:';
                searchEngineLabel.setAttribute('for', `api-base-${provider.id}`);
                const searchEngineInput = document.createElement('input');
                searchEngineInput.type = 'text';
                searchEngineInput.id = `api-base-${provider.id}`;
                searchEngineInput.placeholder = 'Enter Google Search Engine ID';
                searchEngineInput.setAttribute('aria-label', 'Google Search Engine ID');
                searchEngineGroup.appendChild(searchEngineLabel);
                searchEngineGroup.appendChild(searchEngineInput);
                container.appendChild(searchEngineGroup);
            } else {
                input.placeholder = `Enter ${provider.name} API key`;
            }

            input.setAttribute('aria-label', `${provider.name} API key`);
            keyGroup.appendChild(label);
            keyGroup.appendChild(input);
            container.appendChild(keyGroup);
        });
    }

    function initializeTaskToggles() {
        const container = document.getElementById('task-toggles');
        container.innerHTML = '';


        const temperatureSlider = document.getElementById('temperature');
        const temperatureValue = document.getElementById('temperature-value');
        temperatureSlider.addEventListener('input', function () {
            temperatureValue.textContent = this.value;

            taskSettings.temperature = parseFloat(this.value);
            localStorage.setItem('temperature', this.value);
        });

        taskTypes.forEach((task) => {
            const taskToggle = document.createElement('div');
            taskToggle.className = 'task-toggle';
            const toggleContent = document.createElement('div');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `task-${task.id}`;
            checkbox.value = task.id;
            checkbox.setAttribute('aria-label', `Enable ${task.name}`);
            checkbox.checked = false;
            const label = document.createElement('label');
            label.textContent = task.name;
            label.setAttribute('for', `task-${task.id}`);
            const tooltip = document.createElement('span');
            tooltip.className = 'tooltip';
            tooltip.textContent = '?';
            tooltip.setAttribute('aria-hidden', 'true');
            const tooltipText = document.createElement('span');
            tooltipText.className = 'tooltiptext';
            tooltipText.innerHTML = task.tooltip;
            tooltip.appendChild(tooltipText);
            toggleContent.appendChild(checkbox);
            toggleContent.appendChild(label);

            const description = document.createElement('span');
            description.className = 'sr-only';
            description.id = `desc-${task.id}`;
            description.textContent = task.tooltip;
            description.style.position = 'absolute';
            description.style.width = '1px';
            description.style.height = '1px';
            description.style.padding = '0';
            description.style.margin = '-1px';
            description.style.overflow = 'hidden';
            description.style.clip = 'rect(0, 0, 0, 0)';
            description.style.whiteSpace = 'nowrap';
            description.style.border = '0';
            checkbox.setAttribute('aria-describedby', `desc-${task.id}`);
            toggleContent.appendChild(description);
            taskToggle.appendChild(toggleContent);
            container.appendChild(taskToggle);
        });
    }

    function setupEventListeners() {

        document.getElementById('save-api-settings').addEventListener('click', saveApiSettings);
        document.getElementById('reset-api-settings').addEventListener('click', resetApiSettings);

        apiProviders.forEach(provider => {
            const keyInput = document.getElementById(`api-key-${provider.id}`);
            if (keyInput) {
                keyInput.addEventListener('change', () => {

                    populateModelSelections();
                });
            }
        });

        const modelSelect = document.getElementById('model-selection');
        if (modelSelect) {
            modelSelect.addEventListener('change', function () {
                taskSettings.defaultModel = this.value;
                localStorage.setItem('defaultModel', this.value);
            });
        }
        const parsingModelSelect = document.getElementById('parsing-model');
        if (parsingModelSelect) {
            parsingModelSelect.addEventListener('change', function () {
                taskSettings.parsingModel = this.value;
                localStorage.setItem('parsingModel', this.value);
            });
        }


        document.querySelectorAll('input[name="cognitive-mode"]').forEach(radio => {
            radio.addEventListener('change', function () {

                document.getElementById('graph-settings').style.display = 'none';
                document.getElementById('auto-plan-settings').style.display = 'none';

                if (this.value === 'graph') {
                    document.getElementById('graph-settings').style.display = 'block';
                } else if (this.value === 'auto-plan') {
                    document.getElementById('auto-plan-settings').style.display = 'block';
                }

                localStorage.setItem('cognitiveMode', this.value);
            });
        });


        document.getElementById('next-to-task-selection').addEventListener('click', saveCognitiveMode);
        document.getElementById('next-to-task-settings').addEventListener('click', saveTaskSelection);
        document.getElementById('next-to-launch').addEventListener('click', saveTaskSettings);

        document.getElementById('launch-session').addEventListener('click', launchSession);

        document.getElementById('open-basic-chat').addEventListener('click', function () {

            window.open(`/chat/#${sessionId}`, '_blank');
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                const tabs = Array.from(document.querySelectorAll('.tab'));
                const activeTabIndex = tabs.findIndex(tab => tab.classList.contains('active'));
                if (activeTabIndex !== -1) {
                    let newIndex;
                    if (e.key === 'ArrowRight') {
                        newIndex = (activeTabIndex + 1) % tabs.length;
                        newIndex = (activeTabIndex - 1 + tabs.length) % tabs.length;
                    }
                    tabs[newIndex].click();
                    tabs[newIndex].focus();
                    e.preventDefault();
                }
            }
        });
    }

    function navigateToStep(stepId) {

        document.querySelectorAll('.wizard-content').forEach(content => {
            content.classList.remove('active');
        });

        document.querySelectorAll('.wizard-step').forEach(step => {
            step.classList.remove('active');
        });

        document.getElementById(stepId).classList.add('active');
        document.querySelector(`.wizard-step[data-step="${stepId}"]`).classList.add('active');
    }

    function saveApiSettings() {
        const apiKeys = {};
        const apiBase = {};
        apiProviders.forEach(provider => {
            const keyInput = document.getElementById(`api-key-${provider.id}`);
            apiKeys[provider.id] = keyInput.value;

            if (provider.id === 'GoogleSearch') {
                const baseInput = document.getElementById(`api-base-${provider.id}`);
                if (baseInput) {
                    apiBase[provider.id] = baseInput.value;
                } else {
                    apiBase[provider.id] = provider.baseUrl;
                }
            } else {
                apiBase[provider.id] = provider.baseUrl;
            }
        });
        apiSettings = {apiKeys, apiBase};

        populateModelSelections();

        fetch('/userSettings/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'action': 'save',
                'settings': JSON.stringify(apiSettings),
            }),
        })
            .then(response => {
                if (response.ok) {

                    showNotification('API settings saved successfully!');


                    document.getElementById('api-settings-modal').style.display = "none";
                } else {
                    showNotification('Failed to save API settings.', 'error');
                }
            })
            .catch(error => {
                console.error('Error saving API settings:', error);
                showNotification('Error saving API settings: ' + error.message, 'error');
            });
    }

    function saveSessionSettings() {
        return fetch(`/taskChat/settings`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'sessionId': sessionId,
                'action': 'save',
                'settings': JSON.stringify(taskSettings),
                cognitiveMode: cognitiveMode,
            }),
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to save session settings');
                }
                return response;
            });
    }

    function saveTaskSelection() {
        const taskSettingsObj = {};
        taskTypes.forEach(task => {
            const checkbox = document.getElementById(`task-${task.id}`);
            if (checkbox) {
                taskSettingsObj[task.id] = {
                    enabled: checkbox.checked,
                    task_type: task.id
                };

                localStorage.setItem(`task-${task.id}`, checkbox.checked);
            }
        });
        taskSettings.taskSettings = taskSettingsObj;

        saveSessionSettings();
        showNotification('Task selection saved!');
    }

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.style.position = 'fixed';
        notification.style.top = '70px';
        notification.style.right = '20px';
        notification.style.padding = '15px 20px';
        notification.style.borderRadius = '5px';
        notification.style.zIndex = '1000';
        notification.style.maxWidth = '300px';
        notification.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        notification.style.transition = 'opacity 0.3s ease-in-out';
        if (type === 'success') {
            notification.style.backgroundColor = '#4CAF50';
            notification.style.color = 'white';
        } else if (type === 'error') {
            notification.style.backgroundColor = '#F44336';
            notification.style.color = 'white';
        } else if (type === 'warning') {
            notification.style.backgroundColor = '#FF9800';
            notification.style.color = 'white';
        }
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.style.opacity = '0';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    function resetApiSettings() {
        apiProviders.forEach(provider => {
            document.getElementById(`api-key-${provider.id}`).value = '';
        });
        showNotification('API settings reset', 'warning');
    }

    function saveTaskSettings() {

        taskSettings.defaultModel = document.getElementById('model-selection').value;
        taskSettings.parsingModel = document.getElementById('parsing-model').value;
        taskSettings.workingDir = document.getElementById('working-dir').value;
        taskSettings.temperature = parseFloat(document.getElementById('temperature').value);
        taskSettings.autoFix = document.getElementById('auto-fix').checked;

        localStorage.setItem('defaultModel', taskSettings.defaultModel);
        localStorage.setItem('parsingModel', taskSettings.parsingModel);
        localStorage.setItem('workingDir', taskSettings.workingDir);
        localStorage.setItem('temperature', taskSettings.temperature);
        localStorage.setItem('autoFix', taskSettings.autoFix);

        saveSessionSettings();
        showNotification('Task settings saved!');

        updateLaunchSummaries();
    }

    function saveCognitiveMode() {
        const modeElements = document.getElementsByName('cognitive-mode');
        for (const element of modeElements) {
            if (element.checked) {
                cognitiveMode = element.value;

                localStorage.setItem('cognitiveMode', cognitiveMode);
                break;
            }
        }

        if (cognitiveMode === 'auto-plan') {
            taskSettings.maxTaskHistoryChars = parseInt(document.getElementById('max-task-history').value) || 20000;
            taskSettings.maxTasksPerIteration = parseInt(document.getElementById('max-tasks-per-iteration').value) || 3;
            taskSettings.maxIterations = parseInt(document.getElementById('max-iterations').value) || 100;

            localStorage.setItem('maxTaskHistoryChars', taskSettings.maxTaskHistoryChars);
            localStorage.setItem('maxTasksPerIteration', taskSettings.maxTasksPerIteration);
            localStorage.setItem('maxIterations', taskSettings.maxIterations);
        } else if (cognitiveMode === 'graph') {
            taskSettings.graphFile = document.getElementById('graph-file').value;

            localStorage.setItem('graphFile', taskSettings.graphFile);
        }

        showNotification('Cognitive mode saved!');

    }

    function loadSavedSettings() {

        const savedCognitiveMode = localStorage.getItem('cognitiveMode');
        if (savedCognitiveMode) {
            document.querySelector(`input[name="cognitive-mode"][value="${savedCognitiveMode}"]`).checked = true;
            cognitiveMode = savedCognitiveMode;

            if (savedCognitiveMode === 'graph') {
                document.getElementById('graph-settings').style.display = 'block';
            } else if (savedCognitiveMode === 'auto-plan') {
                document.getElementById('auto-plan-settings').style.display = 'block';
            }
        }


        const savedDefaultModel = localStorage.getItem('defaultModel');
        if (savedDefaultModel) {
            taskSettings.defaultModel = savedDefaultModel;
        }
        const savedParsingModel = localStorage.getItem('parsingModel');
        if (savedParsingModel) {
            taskSettings.parsingModel = savedParsingModel;
        }

        const savedWorkingDir = localStorage.getItem('workingDir');
        if (savedWorkingDir) {
            document.getElementById('working-dir').value = savedWorkingDir;
            taskSettings.workingDir = savedWorkingDir;
        }

        if (localStorage.getItem('temperature')) {
            const tempValue = localStorage.getItem('temperature');
            document.getElementById('temperature').value = tempValue;
            document.getElementById('temperature-value').textContent = tempValue;
            taskSettings.temperature = parseFloat(tempValue);
        }

        if (localStorage.getItem('autoFix') === 'true') {
            document.getElementById('auto-fix').checked = true;
            taskSettings.autoFix = true;
        }

        if (localStorage.getItem('maxTaskHistoryChars')) {
            const maxHistory = localStorage.getItem('maxTaskHistoryChars');
            document.getElementById('max-task-history').value = maxHistory;
            taskSettings.maxTaskHistoryChars = parseInt(maxHistory);
        }

        if (localStorage.getItem('maxTasksPerIteration')) {
            const maxTasks = localStorage.getItem('maxTasksPerIteration');
            document.getElementById('max-tasks-per-iteration').value = maxTasks;
            taskSettings.maxTasksPerIteration = parseInt(maxTasks);
        }

        if (localStorage.getItem('maxIterations')) {
            const maxIter = localStorage.getItem('maxIterations');
            document.getElementById('max-iterations').value = maxIter;
            taskSettings.maxIterations = parseInt(maxIter);
        }

        if (localStorage.getItem('graphFile')) {
            const graphFile = localStorage.getItem('graphFile');
            document.getElementById('graph-file').value = graphFile;
            taskSettings.graphFile = graphFile;
        }

        taskTypes.forEach(task => {
            const savedValue = localStorage.getItem(`task-${task.id}`);
            if (savedValue === 'true') {
                const checkbox = document.getElementById(`task-${task.id}`);
                if (checkbox) {
                    checkbox.checked = true;

                    if (!taskSettings.taskSettings) {
                        taskSettings.taskSettings = {};
                    }

                    taskSettings.taskSettings[task.id] = {
                        enabled: true,
                        task_type: task.id
                    };
                }
            }
        });
    }

    function updateLaunchSummaries() {

        const apiSummary = document.getElementById('api-settings-summary');
        apiSummary.innerHTML = '';
        if (apiSettings.apiKeys) {
            const ul = document.createElement('ul');
            for (const [provider, key] of Object.entries(apiSettings.apiKeys)) {
                if (key) {
                    const li = document.createElement('li');
                    li.textContent = `${provider}: API key configured`;
                    ul.appendChild(li);
                }
            }
            apiSummary.appendChild(ul);
        }

        if (!apiSummary.hasChildNodes()) {
            apiSummary.innerHTML = '<p class="warning">⚠️ No API keys configured. Please configure API keys before launching.</p>';
        }

        updateTaskSettingsSummary();
        const taskSummary = document.getElementById('task-settings-summary');
        taskSummary.innerHTML = '';
        const taskList = document.createElement('ul');
        const modelLi = document.createElement('li');
        modelLi.textContent = `Default Model: ${taskSettings.defaultModel}`;
        taskList.appendChild(modelLi);
        const parsingLi = document.createElement('li');
        parsingLi.textContent = `Parsing Model: ${taskSettings.parsingModel}`;
        taskList.appendChild(parsingLi);
        const dirLi = document.createElement('li');
        dirLi.textContent = `Working Directory: ${taskSettings.workingDir}`;
        taskList.appendChild(dirLi);
        const tempLi = document.createElement('li');
        tempLi.textContent = `Temperature: ${taskSettings.temperature}`;
        taskList.appendChild(tempLi);
        const autoFixLi = document.createElement('li');
        autoFixLi.textContent = `Auto Fix: ${taskSettings.autoFix ? 'Enabled' : 'Disabled'}`;
        taskList.appendChild(autoFixLi);

        const enabledTasksLi = document.createElement('li');
        enabledTasksLi.textContent = 'Enabled Tasks: ';
        if (taskSettings.taskSettings) {
            const enabledTasks = [];
            for (const [taskId, settings] of Object.entries(taskSettings.taskSettings)) {
                if (settings.enabled) {
                    const taskType = taskTypes.find(t => t.id === taskId);
                    if (taskType) {
                        enabledTasks.push(taskType.name);
                    }
                }
            }
            if (enabledTasks.length > 0) {
                enabledTasksLi.textContent += enabledTasks.join(', ');
            } else {
                enabledTasksLi.textContent += 'None';
            }
        } else {
            enabledTasksLi.textContent += 'None';
        }
        taskList.appendChild(enabledTasksLi);
        taskSummary.appendChild(taskList);

        const modeSummary = document.getElementById('cognitive-mode-summary');
        modeSummary.innerHTML = '';
        const modeList = document.createElement('ul');
        let modeText = '';
        switch (cognitiveMode) {
            case 'single-task':
                modeText = 'Task Chat Mode - Execute single tasks with AI assistance';
                break;
            case 'auto-plan':
                modeText = 'Auto Plan Mode - Let AI automatically plan and execute complex tasks';
                const autoSettings = document.createElement('li');
                autoSettings.innerHTML = `Settings: Max History: ${taskSettings.maxTaskHistoryChars},
                                 Max Tasks Per Iteration: ${taskSettings.maxTasksPerIteration},

                                 Max Iterations: ${taskSettings.maxIterations}`;
                modeList.appendChild(autoSettings);
                break;
            case 'plan-ahead':
                modeText = 'Plan Ahead Mode - Work with AI to create detailed plans before execution';
                break;
        }
        const modeLi = document.createElement('li');
        modeLi.textContent = modeText;
        modeList.insertBefore(modeLi, modeList.firstChild);
        modeSummary.appendChild(modeList);
    }

    function updateTaskSettingsSummary() {
        const taskSummary = document.getElementById('task-settings-summary');
        if (!taskSummary) return;
        taskSummary.innerHTML = '';
        const enabledTasks = [];
        if (taskSettings.taskSettings) {
            for (const [taskId, settings] of Object.entries(taskSettings.taskSettings)) {
                if (settings.enabled) {
                    const taskType = taskTypes.find(t => t.id === taskId);
                    if (taskType) {
                        enabledTasks.push(taskType.name);
                    }
                }
            }
        }
        taskSummary.innerHTML = `<p>Enabled Tasks: ${enabledTasks.length > 0 ? enabledTasks.join(', ') : 'None selected'}</p>`;
    }

    function launchSession() {

        if (!validateConfiguration()) {
            return;
        }

        document.getElementById('loading').style.display = 'block';

        saveSessionSettings()
            .then(() => {

                let endpoint;
                switch (cognitiveMode) {
                    case 'single-task':
                        endpoint = '/taskChat';
                        break;
                    case 'auto-plan':
                        endpoint = '/autoPlan';
                        break;
                    case 'plan-ahead':
                        endpoint = '/planAhead';
                        break;
                }

                window.location.href = `${endpoint}/#${sessionId}`;
            })
            .catch(error => {
                console.error('Error saving session settings:', error);
                showNotification('Error launching session: ' + error.message, 'error');
                document.getElementById('loading').style.display = 'none';
            });
    }

    function validateConfiguration() {

        let hasApiKey = false;
        if (apiSettings.apiKeys) {
            for (const key of Object.values(apiSettings.apiKeys)) {
                if (key) {
                    hasApiKey = true;
                    break;
                }
            }
        }
        if (!hasApiKey) {
            showNotification('Please configure at least one API key before launching', 'error');

            document.getElementById('api-settings-btn').click();
            return false;
        }

        let hasEnabledTask = false;
        if (taskSettings.taskSettings) {
            for (const settings of Object.values(taskSettings.taskSettings)) {
                if (settings.enabled) {
                    hasEnabledTask = true;
                    break;
                }
            }
        }
        if (!hasEnabledTask) {
            showNotification('Please enable at least one task before launching', 'error');

            navigateToStep('task-selection');
            return false;
        }
        return true;

    }
</script>
</body>
</html>